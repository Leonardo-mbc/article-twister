!function(t,e){"use strict";t.rails!==e&&t.error("jquery-ujs has already been loaded!");var n,a=t(document);t.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",csrfToken:function(){return t("meta[name=csrf-token]").attr("content")},csrfParam:function(){return t("meta[name=csrf-param]").attr("content")},CSRFProtection:function(t){var e=n.csrfToken();e&&t.setRequestHeader("X-CSRF-Token",e)},refreshCSRFTokens:function(){t('form input[name="'+n.csrfParam()+'"]').val(n.csrfToken())},fire:function(e,n,a){var i=t.Event(n);return e.trigger(i,a),i.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t[0].href},isRemote:function(t){return t.data("remote")!==e&&t.data("remote")!==!1},handleRemote:function(a){var i,r,s,o,l,c;if(n.fire(a,"ajax:before")){if(o=a.data("with-credentials")||null,l=a.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,a.is("form")){i=a.attr("method"),r=a.attr("action"),s=a.serializeArray();var u=a.data("ujs:submit-button");u&&(s.push(u),a.data("ujs:submit-button",null))}else a.is(n.inputChangeSelector)?(i=a.data("method"),r=a.data("url"),s=a.serialize(),a.data("params")&&(s=s+"&"+a.data("params"))):a.is(n.buttonClickSelector)?(i=a.data("method")||"get",r=a.data("url"),s=a.serialize(),a.data("params")&&(s=s+"&"+a.data("params"))):(i=a.data("method"),r=n.href(a),s=a.data("params")||null);return c={type:i||"GET",data:s,dataType:l,beforeSend:function(t,i){return i.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+i.accepts.script),n.fire(a,"ajax:beforeSend",[t,i])?void a.trigger("ajax:send",t):!1},success:function(t,e,n){a.trigger("ajax:success",[t,e,n])},complete:function(t,e){a.trigger("ajax:complete",[t,e])},error:function(t,e,n){a.trigger("ajax:error",[t,e,n])},crossDomain:n.isCrossDomain(r)},o&&(c.xhrFields={withCredentials:o}),r&&(c.url=r),n.ajax(c)}return!1},isCrossDomain:function(t){var e=document.createElement("a");e.href=location.href;var n=document.createElement("a");try{return n.href=t,n.href=n.href,!((!n.protocol||":"===n.protocol)&&!n.host||e.protocol+"//"+e.host==n.protocol+"//"+n.host)}catch(a){return!0}},handleMethod:function(a){var i=n.href(a),r=a.data("method"),s=a.attr("target"),o=n.csrfToken(),l=n.csrfParam(),c=t('<form method="post" action="'+i+'"></form>'),u='<input name="_method" value="'+r+'" type="hidden" />';l===e||o===e||n.isCrossDomain(i)||(u+='<input name="'+l+'" value="'+o+'" type="hidden" />'),s&&c.attr("target",s),c.hide().append(u).appendTo("body"),c.submit()},formElements:function(e,n){return e.is("form")?t(e[0].elements).filter(n):e.find(n)},disableFormElements:function(e){n.formElements(e,n.disableSelector).each(function(){n.disableFormElement(t(this))})},disableFormElement:function(t){var n,a;n=t.is("button")?"html":"val",a=t.data("disable-with"),t.data("ujs:enable-with",t[n]()),a!==e&&t[n](a),t.prop("disabled",!0)},enableFormElements:function(e){n.formElements(e,n.enableSelector).each(function(){n.enableFormElement(t(this))})},enableFormElement:function(t){var e=t.is("button")?"html":"val";"undefined"!=typeof t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.prop("disabled",!1)},allowAction:function(t){var e,a=t.data("confirm"),i=!1;if(!a)return!0;if(n.fire(t,"confirm")){try{i=n.confirm(a)}catch(r){(console.error||console.log).call(console,r.stack||r)}e=n.fire(t,"confirm:complete",[i])}return i&&e},blankInputs:function(e,n,a){var i,r,s=t(),o=n||"input,textarea",l=e.find(o);return l.each(function(){if(i=t(this),r=i.is("input[type=checkbox],input[type=radio]")?i.is(":checked"):!!i.val(),r===a){if(i.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+i.attr("name")+'"]').length)return!0;s=s.add(i)}}),s.length?s:!1},nonBlankInputs:function(t,e){return n.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){var a=t.data("disable-with");t.data("ujs:enable-with",t.html()),a!==e&&t.html(a),t.bind("click.railsDisable",function(t){return n.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},n.fire(a,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,a){t.crossDomain||n.CSRFProtection(a)}),t(window).on("pageshow.rails",function(){t(t.rails.enableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableFormElement(e)}),t(t.rails.linkDisableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableElement(e)})}),a.delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(t(this))}),a.delegate(n.buttonDisableSelector,"ajax:complete",function(){n.enableFormElement(t(this))}),a.delegate(n.linkClickSelector,"click.rails",function(e){var a=t(this),i=a.data("method"),r=a.data("params"),s=e.metaKey||e.ctrlKey;if(!n.allowAction(a))return n.stopEverything(e);if(!s&&a.is(n.linkDisableSelector)&&n.disableElement(a),n.isRemote(a)){if(s&&(!i||"GET"===i)&&!r)return!0;var o=n.handleRemote(a);return o===!1?n.enableElement(a):o.fail(function(){n.enableElement(a)}),!1}return i?(n.handleMethod(a),!1):void 0}),a.delegate(n.buttonClickSelector,"click.rails",function(e){var a=t(this);if(!n.allowAction(a)||!n.isRemote(a))return n.stopEverything(e);a.is(n.buttonDisableSelector)&&n.disableFormElement(a);var i=n.handleRemote(a);return i===!1?n.enableFormElement(a):i.fail(function(){n.enableFormElement(a)}),!1}),a.delegate(n.inputChangeSelector,"change.rails",function(e){var a=t(this);return n.allowAction(a)&&n.isRemote(a)?(n.handleRemote(a),!1):n.stopEverything(e)}),a.delegate(n.formSubmitSelector,"submit.rails",function(a){var i,r,s=t(this),o=n.isRemote(s);if(!n.allowAction(s))return n.stopEverything(a);if(s.attr("novalidate")===e&&(i=n.blankInputs(s,n.requiredInputSelector,!1),i&&n.fire(s,"ajax:aborted:required",[i])))return n.stopEverything(a);if(o){if(r=n.nonBlankInputs(s,n.fileInputSelector)){setTimeout(function(){n.disableFormElements(s)},13);var l=n.fire(s,"ajax:aborted:file",[r]);return l||setTimeout(function(){n.enableFormElements(s)},13),l}return n.handleRemote(s),!1}setTimeout(function(){n.disableFormElements(s)},13)}),a.delegate(n.formInputClickSelector,"click.rails",function(e){var a=t(this);if(!n.allowAction(a))return n.stopEverything(e);var i=a.attr("name"),r=i?{name:i,value:a.val()}:null;a.closest("form").data("ujs:submit-button",r)}),a.delegate(n.formSubmitSelector,"ajax:send.rails",function(e){this===e.target&&n.disableFormElements(t(this))}),a.delegate(n.formSubmitSelector,"ajax:complete.rails",function(e){this===e.target&&n.enableFormElements(t(this))}),t(function(){n.refreshCSRFTokens()}))}(jQuery),function(t){function e(t,e){return"function"==typeof t?t.call(e):t}function n(t){for(;t=t.parentNode;)if(t==document)return!0;return!1}function a(e,n){this.$element=t(e),this.options=n,this.enabled=!0,this.fixTitle()}a.prototype={show:function(){var n=this.getTitle();if(n&&this.enabled){var a=this.tip();a.find(".tipsy-inner")[this.options.html?"html":"text"](n),a[0].className="tipsy",a.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var i,r=t.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),s=a[0].offsetWidth,o=a[0].offsetHeight,l=e(this.options.gravity,this.$element[0]);switch(l.charAt(0)){case"n":i={top:r.top+r.height+this.options.offset,left:r.left+r.width/2-s/2};break;case"s":i={top:r.top-o-this.options.offset,left:r.left+r.width/2-s/2};break;case"e":i={top:r.top+r.height/2-o/2,left:r.left-s-this.options.offset};break;case"w":i={top:r.top+r.height/2-o/2,left:r.left+r.width+this.options.offset}}2==l.length&&("w"==l.charAt(1)?i.left=r.left+r.width/2-15:i.left=r.left+r.width/2-s+15),a.css(i).addClass("tipsy-"+l),a.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+l.charAt(0),this.options.className&&a.addClass(e(this.options.className,this.$element[0])),this.options.fade?a.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):a.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){t(this).remove()}):this.tip().remove()},fixTitle:function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("original-title"))&&t.attr("original-title",t.attr("title")||"").removeAttr("title")},getTitle:function(){var t,e=this.$element,n=this.options;this.fixTitle();var t,n=this.options;return"string"==typeof n.title?t=e.attr("title"==n.title?"original-title":n.title):"function"==typeof n.title&&(t=n.title.call(e[0])),t=(""+t).replace(/(^\s*|\s*$)/,""),t||n.fallback},tip:function(){return this.$tip||(this.$tip=t('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),this.$tip.data("tipsy-pointee",this.$element[0])),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},t.fn.tipsy=function(e){function n(n){var i=t.data(n,"tipsy");return i||(i=new a(n,t.fn.tipsy.elementOptions(n,e)),t.data(n,"tipsy",i)),i}function i(){var t=n(this);t.hoverState="in",0==e.delayIn?t.show():(t.fixTitle(),setTimeout(function(){"in"==t.hoverState&&t.show()},e.delayIn))}function r(){var t=n(this);t.hoverState="out",0==e.delayOut?t.hide():setTimeout(function(){"out"==t.hoverState&&t.hide()},e.delayOut)}if(e===!0)return this.data("tipsy");if("string"==typeof e){var s=this.data("tipsy");return s&&s[e](),this}if(e=t.extend({},t.fn.tipsy.defaults,e),e.live||this.each(function(){n(this)}),"manual"!=e.trigger){var o=e.live?"live":"bind",l="hover"==e.trigger?"mouseenter":"focus",c="hover"==e.trigger?"mouseleave":"blur";this[o](l,i)[o](c,r)}return this},t.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},t.fn.tipsy.revalidate=function(){t(".tipsy").each(function(){var e=t.data(this,"tipsy-pointee");e&&n(e)||t(this).remove()})},t.fn.tipsy.elementOptions=function(e,n){return t.metadata?t.extend({},n,t(e).metadata()):n},t.fn.tipsy.autoNS=function(){return t(this).offset().top>t(document).scrollTop()+t(window).height()/2?"s":"n"},t.fn.tipsy.autoWE=function(){return t(this).offset().left>t(document).scrollLeft()+t(window).width()/2?"e":"w"},t.fn.tipsy.autoBounds=function(e,n){return function(){var a={ns:n[0],ew:n.length>1?n[1]:!1},i=t(document).scrollTop()+e,r=t(document).scrollLeft()+e,s=t(this);return s.offset().top<i&&(a.ns="n"),s.offset().left<r&&(a.ew="w"),t(window).width()+t(document).scrollLeft()-s.offset().left<e&&(a.ew="e"),t(window).height()+t(document).scrollTop()-s.offset().top<e&&(a.ns="s"),a.ns+(a.ew?a.ew:"")}}}(jQuery),/*
 * textillate.js
 * http://jschr.github.com/textillate
 * MIT licensed
 *
 * Copyright (C) 2012-2013 Jordan Schroter
 */
function(t){"use strict";function e(e){return/In/.test(e)||t.inArray(e,t.fn.textillate.defaults.inEffects)>=0}function n(e){return/Out/.test(e)||t.inArray(e,t.fn.textillate.defaults.outEffects)>=0}function a(t){return"true"!==t&&"false"!==t?t:"true"===t}function i(e){var n=e.attributes||[],i={};return n.length?(t.each(n,function(t,e){var n=e.nodeName.replace(/delayscale/,"delayScale");/^data-in-*/.test(n)?(i["in"]=i["in"]||{},i["in"][n.replace(/data-in-/,"")]=a(e.nodeValue)):/^data-out-*/.test(n)?(i.out=i.out||{},i.out[n.replace(/data-out-/,"")]=a(e.nodeValue)):/^data-*/.test(n)&&(i[n.replace(/data-/,"")]=a(e.nodeValue))}),i):i}function r(t){for(var e,n,a=t.length;a;e=parseInt(Math.random()*a),n=t[--a],t[a]=t[e],t[e]=n);return t}function s(t,e,n){t.addClass("animated "+e).css("visibility","visible").show(),t.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){t.removeClass("animated "+e),n&&n()})}function o(a,i,o){var l=a.length;return l?(i.shuffle&&(a=r(a)),i.reverse&&(a=a.toArray().reverse()),void t.each(a,function(a,r){function c(){e(i.effect)?u.css("visibility","visible"):n(i.effect)&&u.css("visibility","hidden"),l-=1,!l&&o&&o()}var u=t(r),d=i.sync?i.delay:i.delay*a*i.delayScale;u.text()?setTimeout(function(){s(u,i.effect,c)},d):c()})):void(o&&o())}var l=function(a,r){var s=this,l=t(a);s.init=function(){s.$texts=l.find(r.selector),s.$texts.length||(s.$texts=t('<ul class="texts"><li>'+l.html()+"</li></ul>"),l.html(s.$texts)),s.$texts.hide(),s.$current=t("<span>").html(s.$texts.find(":first-child").html()).prependTo(l),e(r["in"].effect)?s.$current.css("visibility","hidden"):n(r.out.effect)&&s.$current.css("visibility","visible"),s.setOptions(r),s.timeoutRun=null,setTimeout(function(){s.options.autoStart&&s.start()},s.options.initialDelay)},s.setOptions=function(t){s.options=t},s.triggerEvent=function(e){var n=t.Event(e+".tlt");return l.trigger(n,s),n},s["in"]=function(a,r){a=a||0;var l,c=s.$texts.find(":nth-child("+((a||0)+1)+")"),u=t.extend(!0,{},s.options,c.length?i(c[0]):{});c.addClass("current"),s.triggerEvent("inAnimationBegin"),s.$current.html(c.html()).lettering("words"),"char"==s.options.type&&s.$current.find('[class^="word"]').css({display:"inline-block","-webkit-transform":"translate3d(0,0,0)","-moz-transform":"translate3d(0,0,0)","-o-transform":"translate3d(0,0,0)",transform:"translate3d(0,0,0)"}).each(function(){t(this).lettering()}),l=s.$current.find('[class^="'+s.options.type+'"]').css("display","inline-block"),e(u["in"].effect)?l.css("visibility","hidden"):n(u["in"].effect)&&l.css("visibility","visible"),s.currentIndex=a,o(l,u["in"],function(){s.triggerEvent("inAnimationEnd"),u["in"].callback&&u["in"].callback(),r&&r(s)})},s.out=function(e){var n=s.$texts.find(":nth-child("+((s.currentIndex||0)+1)+")"),a=s.$current.find('[class^="'+s.options.type+'"]'),r=t.extend(!0,{},s.options,n.length?i(n[0]):{});s.triggerEvent("outAnimationBegin"),o(a,r.out,function(){n.removeClass("current"),s.triggerEvent("outAnimationEnd"),r.out.callback&&r.out.callback(),e&&e(s)})},s.start=function(t){setTimeout(function(){s.triggerEvent("start"),function e(t){s["in"](t,function(){var n=s.$texts.children().length;t+=1,!s.options.loop&&t>=n?(s.options.callback&&s.options.callback(),s.triggerEvent("end")):(t%=n,s.timeoutRun=setTimeout(function(){s.out(function(){e(t)})},s.options.minDisplayTime))})}(t||0)},s.options.initialDelay)},s.stop=function(){s.timeoutRun&&(clearInterval(s.timeoutRun),s.timeoutRun=null)},s.init()};t.fn.textillate=function(e,n){return this.each(function(){var a=t(this),r=a.data("textillate"),s=t.extend(!0,{},t.fn.textillate.defaults,i(this),"object"==typeof e&&e);r?"string"==typeof e?r[e].apply(r,[].concat(n)):r.setOptions.call(r,s):a.data("textillate",r=new l(this,s))})},t.fn.textillate.defaults={selector:".texts",loop:!1,minDisplayTime:2e3,initialDelay:0,"in":{effect:"fadeInLeftBig",delayScale:1.5,delay:50,sync:!1,reverse:!1,shuffle:!1,callback:function(){}},out:{effect:"hinge",delayScale:1.5,delay:50,sync:!1,reverse:!1,shuffle:!1,callback:function(){}},autoStart:!0,inEffects:[],outEffects:["hinge"],callback:function(){},type:"char"}}(jQuery),/*!	
* Lettering.JS 0.6.1
*
* Copyright 2010, Dave Rupert http://daverupert.com
* Released under the WTFPL license 
* http://sam.zoy.org/wtfpl/
*
* Thanks to Paul Irish - http://paulirish.com - for the feedback.
*
* Date: Mon Sep 20 17:14:00 2010 -0600
*/
function(t){function e(e,n,a,i){var r=e.text().split(n),s="";r.length&&(t(r).each(function(t,e){s+='<span class="'+a+(t+1)+'">'+e+"</span>"+i}),e.empty().append(s))}var n={init:function(){return this.each(function(){e(t(this),"","char","")})},words:function(){return this.each(function(){e(t(this)," ","word"," ")})},lines:function(){return this.each(function(){var n="eefec303079ad17405c889e092e105b0";e(t(this).children("br").replaceWith(n).end(),n,"line","")})}};t.fn.lettering=function(e){return e&&n[e]?n[e].apply(this,[].slice.call(arguments,1)):"letters"!==e&&e?(t.error("Method "+e+" does not exist on jQuery.lettering"),this):n.init.apply(this,[].slice.call(arguments,0))}}(jQuery),function(){}.call(this),function(){}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};this.CheckedAfter=function(){function e(){this.show_selected=t(this.show_selected,this),this.select=t(this.select,this),this.compare_trigger=t(this.compare_trigger,this),this.result_scroll_trigger=t(this.result_scroll_trigger,this),this.selected=[],this.selected_reclist=[]}return e.prototype.select_triger=function(){return $("[data-news]").on("click",function(t){return function(e){var n,a,i;return i=$(e.currentTarget),n=$(i).data("news"),a=$(i).data("sign"),t.select(n,a)}}(this)),$(".time_separater").on("click",function(t){return function(e){var n;return n=new Date($(e.currentTarget).data("time")),$("[data-time]").each(function(e,a){var i,r,s;return n<=new Date($(a).data("time"))?(i=$(a).prev(),r=$(i).data("news"),s=$(i).data("sign"),t.select(r,s,!0)):void 0}),t.show_selected()}}(this))},e.prototype.result_scroll_trigger=function(){return $(window).scroll(function(){var t;return t=$(window).scrollTop(),$("[data-role='controller']").css({"margin-top":t+"px"})})},e.prototype.compare_trigger=function(){return $("[data-reclist]").change(function(t){return function(e){var n,a;return n=$(e.currentTarget),a=n.data("reclist"),t.selected_reclist[a-1]=n.val(),2<=t.selected_reclist.length?analyzer.compare_reclist(t.selected_reclist):void 0}}(this))},e.prototype.select=function(t,e,n){return null==n&&(n=!1),void 0!==this.selected[t]?(delete this.selected[t],$("[data-news='"+t+"']").css({"box-shadow":"0px 0px 0px 0px orange"})):(this.selected[t]=e,$("[data-news='"+t+"']").css({"box-shadow":"0px 0px 0px 3px orange"})),n?void 0:this.show_selected()},e.prototype.show_selected=function(){var t,e;return $("[data-role='result']").html(""),t=$("<span>").attr("class","label label-warning").html("selected"),t=$("<p>").append(t),$("[data-role='result']").append(t),e=["label-danger","label-info","label-success"],this.selected.forEach(function(n){return function(n,a){return t=$("<span>").attr("class","label "+e[n+1]).html(a),$("[data-role='result']").append(t),$("[data-role='result']").append(" ")}}(this)),analyzer.mount_ids(this.selected)},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};this.InstantAnalyzer=function(){function e(){this.compare_reclist=t(this.compare_reclist,this),this.mounted_nps=t(this.mounted_nps,this),this.mounted_precision=t(this.mounted_precision,this),this.mount_ids=t(this.mount_ids,this),this.selected=[]}return e.prototype.mount_ids=function(t){return this.selected=[],t.forEach(function(t){return function(e,n){var a,i,r,s;return i=$("[data-news='"+n+"']"),s=$(i).next(),r=$(i).find("li.active").text(),a=$(s).data("time"),t.selected[n]={sign:e,nps:r,checked_at:a}}}(this)),this.mounted_precision(),this.mounted_nps()},e.prototype.mounted_precision=function(){var t,e,n;return e=0,this.selected.forEach(function(t){return function(t,n){return e+=1}}(this)),t=this.selected.filter(function(t){return function(t,e){return 0<t.sign}}(this)),n=t.length/e,$("[data-role='result']").append($("<p>").html("precision: "+n))},e.prototype.mounted_nps=function(){var t,e,n,a;return n=0,this.selected.forEach(function(t){return function(t,e){return n+=1}}(this)),e=this.selected.filter(function(t){return function(t,e){return 9<=t.nps}}(this)),t=this.selected.filter(function(t){return function(t,e){return t.nps<=6}}(this)),a=e.length/n-t.length/n,$("[data-role='result']").append($("<p>").html("NPS: "+a))},e.prototype.compare_reclist=function(t){return $.ajax({url:"/analyzers/compare_recommendation_list",type:"get",dataType:"json",data:{list:t},success:function(e){return function(e){return e.forEach(function(e,n){var a,i;return a=$("<p>").attr("class","text-success").html("[COMPARE: "+e.compare+"]"),i=$("<p>").attr("class","text-primary").html("Unexp: "+e.unexp),$("[data-role='result']").append(a,i),t.forEach(function(t,n){var i,r,s,o;return a=$("<p>").attr("class","text-success").html("[ "+t+" ]"),r=$("<p>").attr("class","text-primary").html("nps: "+e.nps[t]),s=$("<p>").attr("class","text-primary").html("precision: "+e.precision[t]),i=$("<p>").attr("class","text-primary").html("novelty: "+e.novelty[t]),o=$("<p>").attr("class","text-primary").html("serendipity quant: "+e.serendipity[t]),$("[data-role='result']").append(a,r,s,i,o)})})}}(this)})},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};this.Picker=function(){function n(e){this.make_select_all=t(this.make_select_all,this),this.make_icon_check=t(this.make_icon_check,this),this.pager_enable=t(this.pager_enable,this),this.tab_enable=t(this.tab_enable,this),this.paging=t(this.paging,this),this.link_to=t(this.link_to,this),this.select=t(this.select,this),this.put=t(this.put,this),this.clear_requests=t(this.clear_requests,this),this.fetch=t(this.fetch,this),this.endpoint=e,this.select_cells=[],this.check_icon=this.make_icon_check(),this.page={topic:1,recently:1},this.visible_tab="topic",this.requests=[],this.tab_enable(),this.pager_enable(),this.importer_enable()}return n.prototype.fetch=function(t,e){var n,a,i;if(this.clear_requests(),a={topic_id:null,news_id:null,action:"",dispatch:function(){}},t)for(n in t)i=t[n],a[n]=i;return this.requests.push($.ajax({type:"GET",url:this.endpoint+"/api/v1/"+a.action,dataType:"json",data:a,success:function(t){return function(n){return t.put(n,e,!0)}}(this)}))},n.prototype.clear_requests=function(){return this.requests.forEach(function(t){return function(e){return e.abort(),t.requests.splice(e,1)}}(this))},n.prototype.put=function(t,e,n){var a,i;return i=[],a=$("."+e+"-cells"),i.push(this.make_select_all()),t.topics&&$.each(t.topics,function(t){return function(e,n){var a,r,s;return r={topic_id:n.id},s=$("<tr>"),$(s).attr("data-id",n.id),a=$("<td class='checker'>").append(t.check_icon).on("click",function(e){return t.select(e,n.id)}),s.append(a),s.append($("<td>").append(t.link_to("article_list",n.id))),s.append($("<td>").append(n.title)),s.append($("<td>").append(n.quant)),s.append($("<td>").append(n.updated_at)),i.push(s)}}(this)),t.news&&$.each(t.news,function(t){return function(n,a){var r,s;return r={news_id:a.id},s=$("<tr>"),$(s).attr("data-id",a.id),$(s).on("click",function(e){return t.select(e,a.id)}),s.append($("<td>").append(t.check_icon)),s.append($("<td>").append(a.id)),s.append($("<td>").append(a.title)),"recently"!==e&&s.append($("<td>").append(a.body)),"recently"!==e&&s.append($("<td>").append(a.url)),s.append($("<td>").append(a.created_at)),i.push(s)}}(this)),"items"===e&&(i=[],$.each(this.select_cells,function(t,e){var n;return n=$("<tr>"),n.append($("<td>").append(e)),"string"==typeof e&&n.append($("<td>").append("\u30c8\u30d4\u30c3\u30af\u7fa4")),"number"==typeof e&&n.append($("<td>").append("\u5358\u4e00\u30cb\u30e5\u30fc\u30b9")),i.push(n)}),$(a).html(i)),"details"===e?($(".details").html(""),$.each(t.news,function(t){return function(t,e){var n,a;return n=$("<p>").html(e.title),a=$("<small>").html(e.source),$(".details").append(n,a)}}(this))):(n&&($("[data-tab]").removeClass("active"),$("[data-tab='"+e+"']").addClass("active"),$("table").hide(),$(a).show()),$(a).html(i))},n.prototype.select=function(t,n,a){var i;return null==a&&(a=!1),i=t.currentTarget?t.currentTarget:t,e.call(this.select_cells,n)>=0?(this.select_cells.splice(this.select_cells.indexOf(n),1),$(i).find("i").css("opacity",0)):(this.select_cells.push(n),$(i).find("i").css("opacity",1)),this.put(this.select_cells,"items",a)},n.prototype.link_to=function(t,e){var n;return n=$("<a>"),"article_list"===t&&($(n).html(e),$(n).css({cursor:"pointer"}),$(n).on("click",function(t){return function(){return t.fetch({topic_id:e},"article")}}(this))),"topic_list"===t&&($(n).attr("class","btn btn-default"),$(n).on("click",function(t){return function(){return t.fetch({},"topic")}}(this))),n},n.prototype.paging=function(t){var e,n;return $("[data-role='page_num']").removeClass("active"),n=$("[data-role='page_num']").get(t-1),$(n).addClass("active"),this.page[this.visible_tab]=t,e="","recently"===this.visible_tab&&(e="recently.php"),this.fetch({page:t,action:e},this.visible_tab)},n.prototype.erase=function(t){return $("."+t+"-cells").html("")},n.prototype.tab_enable=function(){return $(".import").hide(),$(".recently-cells").hide(),$(".article-cells").hide(),$(".items-cells").hide(),$("[data-tab]").on("click",function(t){return function(e){var n;return n=$(e.currentTarget).data("tab"),t.visible_tab=n,$("table").hide(),$("."+n+"-cells").show(),"topic"===n||"recently"===n||"imported_news"===n?$(".pagination").show():$(".pagination").hide(),"items"===n?$(".import").show():$(".import").hide()}}(this))},n.prototype.pager_enable=function(){return $("[data-role='page_num']").on("click",function(t){return function(e){var n;return n=parseInt($(e.currentTarget).text()),t.paging(n)}}(this)),$("[data-role='page_prev']").on("click",function(t){return function(e){var n;return n=t.page[t.visible_tab]-1,t.paging(n)}}(this)),$("[data-role='page_next']").on("click",function(t){return function(e){var n;return n=t.page[t.visible_tab]+1,t.paging(n)}}(this))},n.prototype.importer_enable=function(){return $("[data-import]").on("click",function(t){return function(e){var n,a;return $("[data-import]").addClass("disabled"),n=$(e.currentTarget).data("import"),a={topics:[],news:[]},"news"===n?a.news=t.select_cells.filter(function(t){return"number"==typeof t}):(a.topics=t.select_cells.filter(function(t){return"string"==typeof t}),a.news=t.select_cells.filter(function(t){return"number"==typeof t})),console.log("\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4e2d..."),$.ajax({type:"POST",url:"import",data:{selected:a},success:function(t){return $("[data-import]").removeClass("disabled")},error:function(t){return $("[data-import]").removeClass("disabled")}})}}(this)),$("[data-combine]").on("click",function(t){return function(e){var n,a;return n=$("#profile_name").val(),$("#profile_name").parent().removeClass("has-error"),n?($("[data-combine]").addClass("disabled"),a=t.select_cells.filter(function(t){return"number"==typeof t}),$.ajax({type:"POST",url:"combine",data:{selected:a,name:n},success:function(t){return $("[data-combine]").removeClass("disabled")},error:function(t){return $("[data-combine]").removeClass("disabled")}})):$("#profile_name").parent().addClass("has-error")}}(this))},n.prototype.make_icon_check=function(){var t,e;return t=$("<i>"),$(t).attr("class","fa fa-check-circle"),$(t).css("opacity",0),e=$(t).get(0).outerHTML},n.prototype.make_select_all=function(){var t,e,n;return n=$("<tr>"),e=$("<td>").attr("colspan",6),t=$("<a>").attr("class","btn btn-link").attr("data-select","uncheck").append($("<i>").attr("class","fa fa-square-o")).append(" \u3059\u3079\u3066\u9078\u629e").on("click",function(t){return function(e){var n;return n=$(e.currentTarget).data("select"),"check"===n&&($("tr:visible[data-id]").each(function(e,n){var a;return a=$(n).data("id"),t.select(n,a)}),$(e.currentTarget).data("select","uncheck"),$(e.currentTarget).html($("<i>").attr("class","fa fa-square-o")).append(" \u3059\u3079\u3066\u9078\u629e")),"uncheck"===n?($("tr:visible[data-id]").each(function(e,n){var a;return a=$(n).data("id"),t.select(n,a)}),$(e.currentTarget).data("select","check"),$(e.currentTarget).html($("<i>").attr("class","fa fa-check-square-o")).append(" \u3059\u3079\u3066\u9078\u629e\u89e3\u9664")):void 0}}(this)),$(n).append($(e).append(t)),n},n}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};this.Plotter=function(){function e(e,n,a){this.normal_recommend=t(this.normal_recommend,this),this.recommend=t(this.recommend,this),this.scale_update=t(this.scale_update,this),this.make_thumbs=t(this.make_thumbs,this),this.cluster_rating=t(this.cluster_rating,this),this.svg_replace=t(this.svg_replace,this),this.plot_gravities=t(this.plot_gravities,this),this.clustering=t(this.clustering,this),this.plot=t(this.plot,this),this.mount=t(this.mount,this),this.clear_axis=t(this.clear_axis,this),this.change_axis_direct=t(this.change_axis_direct,this),this.change_divide=t(this.change_divide,this),this.append_axis_label=t(this.append_axis_label,this),this.tuner_scroll_trigger=t(this.tuner_scroll_trigger,this),this.cluster_slider_trigger=t(this.cluster_slider_trigger,this),this.width=e,this.height=n,this.picker=a,this.axis_label={X:null,Y:null},this.div_num=4,this.stage=d3.select(".stage").append("svg"),this.dataset=[],this.user_data=[],this.stage.attr("width",this.width).attr("height",this.height),this.padding=50,this.xScale=d3.scale.linear().domain([-1,1]).range([this.padding,this.width-this.padding]),this.yScale=d3.scale.linear().domain([-1,1]).range([this.height-this.padding,this.padding]),this.append_axis_label()}return e.prototype.cluster_slider_trigger=function(){return $("[data-role='divider']").on({input:function(t){return function(t){return $("#divider").html($(t.currentTarget).val())}}(this),change:function(t){return function(e){return t.div_num=$(e.currentTarget).val(),t.clustering()}}(this)}),this.axis_label.X===this.axis_label.Y&&null===this.axis_label.X?$("[data-role='divider']").get(0).disabled=!0:void 0},e.prototype.tuner_scroll_trigger=function(){return $(window).scroll(function(){var t;return t=$(window).scrollTop(),$("[data-role='tuner']").css({"margin-top":t+"px"}),$("[data-role='question']").css({"margin-top":t+"px"})})},e.prototype.append_axis_label=function(){var t,e;return d3.selectAll("g").remove(),t=d3.svg.axis().scale(this.xScale).orient("bottom"),e=d3.svg.axis().scale(this.yScale).orient("left"),this.stage.append("g").attr("class","axis_x").attr("transform","translate(0, "+(this.height-this.padding)+")").call(t),this.stage.append("g").attr("class","axis_y").attr("transform","translate("+this.padding+", 0)").call(e)},e.prototype.change_divide=function(t){return this.div_num=t},e.prototype.change_axis=function(t,e){return $(".loading").fadeIn(100),this.axis_label[t]=e,$("[data-role='divider']").get(0).disabled=!1,$("[data-title='"+t+"']").html(e).parent().removeClass("open"),$("[data-label='"+t+"']").html(e)},e.prototype.change_axis_direct=function(t){var e;return"X"===t&&(e="x_similar"),"Y"===t&&(e="y_similar"),$(".loading").fadeIn(100),$.ajax({url:"/articles/0/"+e,type:"get",success:function(t){return function(t){return $(".loading").fadeOut(100)}}(this)})},e.prototype.clear_axis=function(t){return this.axis_label[t]=null,this.dataset.forEach(function(e){return function(n,a){return"X"===t&&(e.dataset[a].x=.5,e.user_data.x=.5),"Y"===t&&(e.dataset[a].y=.5,e.user_data.y=.5),$("[data-title='"+t+"']").html(t+"\u8ef8\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0")}}(this)),this.axis_label.X===this.axis_label.Y&&null===this.axis_label.X&&($("[data-role='divider']").get(0).disabled=!0),this.plot()},e.prototype.mount=function(t,e,n){switch(t){case"x":if("user"!==e)return this.dataset[e]?this.dataset[e].x=n:this.dataset[e]={x:n,y:.5};if(this.user_data&&(this.user_data.x=n,!this.user_data.y))return this.user_data.y=.5;break;case"y":return"user"===e?this.user_data?(this.user_data.x||(this.user_data.x=.5),this.user_data.y=n):this.user_data={x:.5,y:n}:this.dataset[e]?this.dataset[e].y=n:this.dataset[e]={x:.5,y:n}}},e.prototype.plot=function(){var t,e,n,a;return n=this,e=.5,a=this.padding*e,t=this.padding*e,this.stage.selectAll("image").remove(),this.stage.selectAll("text").remove(),this.scale_update(),this.dataset.forEach(function(e){return function(i,r){return e.stage.append("image").attr("id",r).attr("x",e.xScale(i.x)-.5*a).attr("y",e.yScale(i.y)-.5*t).attr("class","document").attr("width",a).attr("height",t).attr("xlink:href","/images/document_gray.svg").on("mouseover",function(){return n.picker.fetch({news_id:r},"details"),d3.select(this).attr("xlink:href","/images/document_blue.svg")}).on("mouseout",function(){var t,e;return e=d3.select(this),t=e.attr("cluster"),t?e.attr("xlink:href","/images/document_clusters/"+t+".svg"):e.attr("xlink:href","/images/document_gray.svg")}).on("click",function(){return console.log("open",r)})}}(this)),this.stage.append("image").attr("x",this.xScale(this.user_data.x)-.5*a).attr("y",this.yScale(this.user_data.y)-.5*t).attr("class","document").attr("width",a).attr("height",t).attr("xlink:href","/images/user.svg"),(this.axis_label.X!==this.axis_label.Y||null!==this.axis_label.X)&&this.clustering(),this.append_axis_label()},e.prototype.clustering=function(){var t,e;return d3.selectAll("text").remove(),t=(new Date).getTime(),e=[],this.dataset.forEach(function(t){return function(t,n){return e.push({news_id:n,x:t.x,y:t.y})}}(this)),$.ajax({url:"/articles/clustering",type:"post",data:{map:e,div:this.div_num,label_quant:5,filename:t},success:function(e){return function(){return $(".loading").fadeOut(100),e.recommend(t)}}(this)}),this.append_axis_label()},e.prototype.plot_gravities=function(t,e,n){var a,i,r;return i=.8,r=this.padding*i,a=this.padding*i,this.stage.append("text").attr("x",this.xScale(e)-.5*r).attr("y",this.yScale(n)-.5*a).attr("original-title",this.make_thumbs(t)).attr("class","gravity").text(t),$("text").tipsy({gravity:"s",delayOut:50,html:!0,trigger:"focus"})},e.prototype.svg_replace=function(t,e){return $(".stage").find("image#"+t).attr("href","/images/document_clusters/"+e+".svg").attr("cluster",e)},e.prototype.cluster_rating=function(t,e){return $.ajax({url:"/users/instant_profile_update",type:"get",data:{word:t,score:e},success:function(t){return function(e){return"\u81ea\u5206\u306e\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb"===t.axis_label.X?t.change_axis_direct("X"):"\u81ea\u5206\u306e\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb"===t.axis_label.Y?t.change_axis_direct("Y"):void 0}}(this)})},e.prototype.make_thumbs=function(t){var e,n,a,i,r,s,o;return r=$("<a>").attr("href",'JavaScript: plotter.cluster_rating("'+t+'", 1)').append($("<i>").attr("class","fa fa-thumbs-up sm1")).append($("<span>").html("x1")).get(0).outerHTML,s=$("<a>").attr("href",'JavaScript: plotter.cluster_rating("'+t+'", 2)').append($("<i>").attr("class","fa fa-thumbs-up sm2")).append($("<span>").html("x2")).get(0).outerHTML,o=$("<a>").attr("href",'JavaScript: plotter.cluster_rating("'+t+'", 3)').append($("<i>").attr("class","fa fa-thumbs-up sm2")).append($("<span>").html("x3")).get(0).outerHTML,n=$("<a>").attr("href",'JavaScript: plotter.cluster_rating("'+t+'", -1)').append($("<i>").attr("class","fa fa-thumbs-down sm1")).append($("<span>").html("x1")).get(0).outerHTML,a=$("<a>").attr("href",'JavaScript: plotter.cluster_rating("'+t+'", -2)').append($("<i>").attr("class","fa fa-thumbs-down sm2")).append($("<span>").html("x2")).get(0).outerHTML,i=$("<a>").attr("href",'JavaScript: plotter.cluster_rating("'+t+'", -3)').append($("<i>").attr("class","fa fa-thumbs-down sm2")).append($("<span>").html("x3")).get(0).outerHTML,e=i+" "+a+" "+n+" | "+r+" "+s+" "+o},e.prototype.scale_update=function(){var t,e,n,a,i,r;return t=[],e=[],this.dataset.map(function(n){return t.push(n.x),e.push(n.y)}),i=Math.min.apply(null,t)-.05,r=Math.min.apply(null,e)-.05,n=Math.max.apply(null,t)+.05,a=Math.max.apply(null,e)+.05,this.xScale=d3.scale.linear().domain([i,n]).range([this.padding,this.width-this.padding]),this.yScale=d3.scale.linear().domain([r,a]).range([this.height-this.padding,this.padding])},e.prototype.recommend=function(t){var e;return e=30,$.ajax({url:"/articles/recommend",type:"post",data:{filename:t,user_x:this.user_data.x,user_y:this.user_data.y,axis_label_x:this.axis_label.X,axis_label_y:this.axis_label.Y,quant:e},success:function(t){return function(n){var a,i;return $("[data-role='recommend']").html(""),a=$("<div>").attr("class","alert alert-dismissible alert-info").append($("<strong>").html("\u3042\u306a\u305f\u3078\u306e\u304a\u3059\u3059\u3081\u3000\u4e0a\u4f4d "+e+" \u4ef6")),i=$("<a>").attr("class","btn btn-default btn-lg btn-block margin-bottom").html("\u6b21\u3078").on("click",function(e){return t.normal_recommend()}),$("[data-role='recommend']").html(a).append(n,i),rating.rating_enable()}}(this)})},e.prototype.normal_recommend=function(t){var e;return $(".loading").fadeIn(100),e=30,$.ajax({url:"/articles/normal_recommend",type:"post",data:{quant:e},success:function(t){return function(t){var n;return $(".loading").fadeOut(100),$("html,body").animate({scrollTop:0},{duration:2e3,easing:"easeOutExpo"}),n=$("<div>").attr("class","alert alert-dismissible alert-info").append($("<strong>").html("\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u8abf\u6574\u524d\u306b\u304a\u3059\u3059\u3081\u3060\u3063\u305f\u3082\u306e\u3000\u4e0a\u4f4d "+e+" \u4ef6")),$("[data-role='normal_recommend']").html(n).append(t),$("[data-role='tuner']").fadeOut(300,function(){return $("[data-role='normal_recommend']").fadeIn()}),rating.rating_enable()}}(this)})},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};this.Rating=function(){function e(e){this.show_question=t(this.show_question,this),this.user_id=e}return e.prototype.rating_enable=function(){return $("[data-news]").draggable({axis:"x",revert:!0,revertDuration:100,opacity:.7,handle:".panel-heading",scroll:!1,drag:function(t,e){var n;return n=e.position.left,n>150&&$(e.helper).removeClass("panel-info").addClass("panel-success"),-150>n&&$(e.helper).removeClass("panel-info").addClass("panel-danger"),n>=-150&&150>=n?$(e.helper).removeClass("panel-info, panel-danger").addClass("panel-info"):void 0},stop:function(t){return function(e,n){var a,i,r;return r=n.position.left,a=$(n.helper).data("news"),r>150&&(i=1),-150>r&&(i=-1),r>=-150&&150>=r&&(i=0),t.push(a,i)}}(this)}),$("[data-role='nps'] a").on("click",function(t){return function(e){var n,a,i,r,s,o;return s=$(e.currentTarget),n=$(s).parent(),o=$(n).parent(),i=$(o).parent(),$(o).find("li").removeClass("active"),$(n).addClass("active"),a=$(i).data("news"),r=parseInt($(s).text()),t.nps_push(a,r)}}(this)),$("[data-role='known'] a").on("click",function(t){return function(e){var n,a,i,r,s;return s=$(e.currentTarget),n=$(s).parent(),i=$(n).parent(),$(n).find("a").removeClass("active"),$(s).addClass("active"),a=$(i).data("news"),r=parseInt($(s).data("score")),t.known_push(a,!!r)}}(this))},e.prototype.push=function(t,e){return $.ajax({url:"/articles/push_rate",type:"get",data:{news_id:t,sign:e},dataType:"json",success:function(e){var n,a;return delete plotter.dataset[t],a=$("[data-news='"+t+"']").find("h3"),n=new RegExp("glyphicon-ok","i"),a.html().match(n)?void 0:$(a).prepend('<span class="glyphicon glyphicon-ok" aria-hidden="true"></span> ')}})},e.prototype.nps_push=function(t,e){return $.ajax({url:"/articles/push_rate",type:"get",data:{news_id:t,nps:e},dataType:"json"})},e.prototype.known_push=function(t,e){return $.ajax({url:"/articles/push_rate",type:"get",data:{news_id:t,known:e},dataType:"json"})},e.prototype.show_question=function(){return $("html,body").animate({scrollTop:0},{duration:2e3,easing:"easeOutExpo"}),$("[data-role='tuner']").fadeOut(300,function(){return $("[data-role='question']").fadeIn()})},e}()}.call(this),function(){}.call(this),function(){}.call(this),$(window).scroll(function(){$(".loading").css({"margin-top":$(window).scrollTop()})}),$(".loading h1").textillate({loop:!0,minDisplayTime:1e3,autoStart:!0,"in":{effect:"bounce",delayScale:1.5,delay:50,sync:!1,shuffle:!0},out:{effect:"bounce",delayScale:1.5,delay:50,sync:!1,shuffle:!0}});