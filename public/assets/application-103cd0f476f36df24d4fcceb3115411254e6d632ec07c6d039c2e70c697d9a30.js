!function(t,e){"use strict";t.rails!==e&&t.error("jquery-ujs has already been loaded!");var a,n=t(document);t.rails=a={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",csrfToken:function(){return t("meta[name=csrf-token]").attr("content")},csrfParam:function(){return t("meta[name=csrf-param]").attr("content")},CSRFProtection:function(t){var e=a.csrfToken();e&&t.setRequestHeader("X-CSRF-Token",e)},refreshCSRFTokens:function(){t('form input[name="'+a.csrfParam()+'"]').val(a.csrfToken())},fire:function(e,a,n){var i=t.Event(a);return e.trigger(i,n),i.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t[0].href},isRemote:function(t){return t.data("remote")!==e&&t.data("remote")!==!1},handleRemote:function(n){var i,r,s,o,l,c;if(a.fire(n,"ajax:before")){if(o=n.data("with-credentials")||null,l=n.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,n.is("form")){i=n.attr("method"),r=n.attr("action"),s=n.serializeArray();var u=n.data("ujs:submit-button");u&&(s.push(u),n.data("ujs:submit-button",null))}else n.is(a.inputChangeSelector)?(i=n.data("method"),r=n.data("url"),s=n.serialize(),n.data("params")&&(s=s+"&"+n.data("params"))):n.is(a.buttonClickSelector)?(i=n.data("method")||"get",r=n.data("url"),s=n.serialize(),n.data("params")&&(s=s+"&"+n.data("params"))):(i=n.data("method"),r=a.href(n),s=n.data("params")||null);return c={type:i||"GET",data:s,dataType:l,beforeSend:function(t,i){return i.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+i.accepts.script),a.fire(n,"ajax:beforeSend",[t,i])?void n.trigger("ajax:send",t):!1},success:function(t,e,a){n.trigger("ajax:success",[t,e,a])},complete:function(t,e){n.trigger("ajax:complete",[t,e])},error:function(t,e,a){n.trigger("ajax:error",[t,e,a])},crossDomain:a.isCrossDomain(r)},o&&(c.xhrFields={withCredentials:o}),r&&(c.url=r),a.ajax(c)}return!1},isCrossDomain:function(t){var e=document.createElement("a");e.href=location.href;var a=document.createElement("a");try{return a.href=t,a.href=a.href,!((!a.protocol||":"===a.protocol)&&!a.host||e.protocol+"//"+e.host==a.protocol+"//"+a.host)}catch(n){return!0}},handleMethod:function(n){var i=a.href(n),r=n.data("method"),s=n.attr("target"),o=a.csrfToken(),l=a.csrfParam(),c=t('<form method="post" action="'+i+'"></form>'),u='<input name="_method" value="'+r+'" type="hidden" />';l===e||o===e||a.isCrossDomain(i)||(u+='<input name="'+l+'" value="'+o+'" type="hidden" />'),s&&c.attr("target",s),c.hide().append(u).appendTo("body"),c.submit()},formElements:function(e,a){return e.is("form")?t(e[0].elements).filter(a):e.find(a)},disableFormElements:function(e){a.formElements(e,a.disableSelector).each(function(){a.disableFormElement(t(this))})},disableFormElement:function(t){var a,n;a=t.is("button")?"html":"val",n=t.data("disable-with"),t.data("ujs:enable-with",t[a]()),n!==e&&t[a](n),t.prop("disabled",!0)},enableFormElements:function(e){a.formElements(e,a.enableSelector).each(function(){a.enableFormElement(t(this))})},enableFormElement:function(t){var e=t.is("button")?"html":"val";"undefined"!=typeof t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.prop("disabled",!1)},allowAction:function(t){var e,n=t.data("confirm"),i=!1;if(!n)return!0;if(a.fire(t,"confirm")){try{i=a.confirm(n)}catch(r){(console.error||console.log).call(console,r.stack||r)}e=a.fire(t,"confirm:complete",[i])}return i&&e},blankInputs:function(e,a,n){var i,r,s=t(),o=a||"input,textarea",l=e.find(o);return l.each(function(){if(i=t(this),r=i.is("input[type=checkbox],input[type=radio]")?i.is(":checked"):!!i.val(),r===n){if(i.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+i.attr("name")+'"]').length)return!0;s=s.add(i)}}),s.length?s:!1},nonBlankInputs:function(t,e){return a.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){var n=t.data("disable-with");t.data("ujs:enable-with",t.html()),n!==e&&t.html(n),t.bind("click.railsDisable",function(t){return a.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},a.fire(n,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,n){t.crossDomain||a.CSRFProtection(n)}),t(window).on("pageshow.rails",function(){t(t.rails.enableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableFormElement(e)}),t(t.rails.linkDisableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableElement(e)})}),n.delegate(a.linkDisableSelector,"ajax:complete",function(){a.enableElement(t(this))}),n.delegate(a.buttonDisableSelector,"ajax:complete",function(){a.enableFormElement(t(this))}),n.delegate(a.linkClickSelector,"click.rails",function(e){var n=t(this),i=n.data("method"),r=n.data("params"),s=e.metaKey||e.ctrlKey;if(!a.allowAction(n))return a.stopEverything(e);if(!s&&n.is(a.linkDisableSelector)&&a.disableElement(n),a.isRemote(n)){if(s&&(!i||"GET"===i)&&!r)return!0;var o=a.handleRemote(n);return o===!1?a.enableElement(n):o.fail(function(){a.enableElement(n)}),!1}return i?(a.handleMethod(n),!1):void 0}),n.delegate(a.buttonClickSelector,"click.rails",function(e){var n=t(this);if(!a.allowAction(n)||!a.isRemote(n))return a.stopEverything(e);n.is(a.buttonDisableSelector)&&a.disableFormElement(n);var i=a.handleRemote(n);return i===!1?a.enableFormElement(n):i.fail(function(){a.enableFormElement(n)}),!1}),n.delegate(a.inputChangeSelector,"change.rails",function(e){var n=t(this);return a.allowAction(n)&&a.isRemote(n)?(a.handleRemote(n),!1):a.stopEverything(e)}),n.delegate(a.formSubmitSelector,"submit.rails",function(n){var i,r,s=t(this),o=a.isRemote(s);if(!a.allowAction(s))return a.stopEverything(n);if(s.attr("novalidate")===e&&(i=a.blankInputs(s,a.requiredInputSelector,!1),i&&a.fire(s,"ajax:aborted:required",[i])))return a.stopEverything(n);if(o){if(r=a.nonBlankInputs(s,a.fileInputSelector)){setTimeout(function(){a.disableFormElements(s)},13);var l=a.fire(s,"ajax:aborted:file",[r]);return l||setTimeout(function(){a.enableFormElements(s)},13),l}return a.handleRemote(s),!1}setTimeout(function(){a.disableFormElements(s)},13)}),n.delegate(a.formInputClickSelector,"click.rails",function(e){var n=t(this);if(!a.allowAction(n))return a.stopEverything(e);var i=n.attr("name"),r=i?{name:i,value:n.val()}:null;n.closest("form").data("ujs:submit-button",r)}),n.delegate(a.formSubmitSelector,"ajax:send.rails",function(e){this===e.target&&a.disableFormElements(t(this))}),n.delegate(a.formSubmitSelector,"ajax:complete.rails",function(e){this===e.target&&a.enableFormElements(t(this))}),t(function(){a.refreshCSRFTokens()}))}(jQuery),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].indexOf||function(t){for(var e=0,a=this.length;a>e;e++)if(e in this&&this[e]===t)return e;return-1};this.Picker=function(){function a(e){this.make_icon_check=t(this.make_icon_check,this),this.pager_enable=t(this.pager_enable,this),this.tab_enable=t(this.tab_enable,this),this.link_to=t(this.link_to,this),this.select=t(this.select,this),this.put=t(this.put,this),this.clear_requests=t(this.clear_requests,this),this.fetch=t(this.fetch,this),this.endpoint=e,this.select_cells=[],this.check_icon=this.make_icon_check(),this.topic_page=1,this.requests=[],this.tab_enable(),this.pager_enable(),this.importer_enable()}return a.prototype.fetch=function(t,e){var a,n,i;if(this.clear_requests(),n={topic_id:null,news_id:null},t)for(a in t)i=t[a],n[a]=i;return this.requests.push($.ajax({type:"GET",url:this.endpoint+"/api/v1/",dataType:"json",data:n,success:function(t){return function(a){return t.put(a,e,!0)}}(this)}))},a.prototype.clear_requests=function(){return this.requests.forEach(function(t){return function(e){return e.abort(),t.requests.splice(e,1)}}(this))},a.prototype.put=function(t,e,a){var n,i;return i=[],n=$("."+e+"-cells"),t.topics&&$.each(t.topics,function(t){return function(e,a){var n,r,s;return r={topic_id:a.id},s=$("<tr>"),$(s).attr("data-id",a.id),n=$("<td class='checker'>").append(t.check_icon).on("click",function(e){return t.select(e,a.id)}),s.append(n),s.append($("<td>").append(t.link_to("article_list",a.id))),s.append($("<td>").append(a.title)),s.append($("<td>").append(a.quant)),s.append($("<td>").append(a.updated_at)),i.push(s)}}(this)),t.news&&$.each(t.news,function(t){return function(e,a){var n,r;return n={news_id:a.id},r=$("<tr>"),$(r).attr("data-id",a.id),$(r).on("click",function(e){return t.select(e,a.id)}),r.append($("<td>").append(t.check_icon)),r.append($("<td>").append(a.id)),r.append($("<td>").append(a.title)),r.append($("<td>").append(a.body)),r.append($("<td>").append(a.url)),i.push(r)}}(this)),"items"===e&&(i=[],$.each(this.select_cells,function(t,e){var a;return a=$("<tr>"),a.append($("<td>").append(e)),"string"==typeof e&&a.append($("<td>").append("\u30c8\u30d4\u30c3\u30af\u7fa4")),"number"==typeof e&&a.append($("<td>").append("\u5358\u4e00\u30cb\u30e5\u30fc\u30b9")),i.push(a)}),$(n).html(i)),"details"===e?($(".details").html(""),$.each(t.news,function(t){return function(t,e){var a,n;return a=$("<p>").html(e.title),n=$("<small>").html(e.source),$(".details").append(a,n)}}(this))):(a&&($("[data-tab]").removeClass("active"),$("[data-tab='"+e+"']").addClass("active"),$("table").hide(),$(n).show()),$(n).html(i))},a.prototype.select=function(t,a,n){var i;return null==n&&(n=!1),i=t.currentTarget?t.currentTarget:t,e.call(this.select_cells,a)>=0?(this.select_cells.splice(this.select_cells.indexOf(a),1),$(i).find("i").css("opacity",0)):(this.select_cells.push(a),$(i).find("i").css("opacity",1)),this.put(this.select_cells,"items",n)},a.prototype.link_to=function(t,e){var a;return a=$("<a>"),"article_list"===t&&($(a).html(e),$(a).css({cursor:"pointer"}),$(a).on("click",function(t){return function(){return t.fetch({topic_id:e},"article")}}(this))),"topic_list"===t&&($(a).attr("class","btn btn-default"),$(a).on("click",function(t){return function(){return t.fetch({},"topic")}}(this))),a},a.prototype.paging=function(t){var e;return $("[data-role='page_num']").removeClass("active"),e=$("[data-role='page_num']").get(t-1),$(e).addClass("active"),this.topic_page=t,this.fetch({page:t},"topic")},a.prototype.erase=function(t){return $("."+t+"-cells").html("")},a.prototype.tab_enable=function(){return $(".import").hide(),$(".items-cells").hide(),$("[data-tab]").on("click",function(t){return function(t){var e;return e=$(t.currentTarget).data("tab"),$("table").hide(),$("."+e+"-cells").show(),"topic"===e||"imported_news"===e?$(".pagination").show():$(".pagination").hide(),"items"===e?$(".import").show():$(".import").hide()}}(this))},a.prototype.pager_enable=function(){return $("[data-role='page_num']").on("click",function(t){return function(e){var a;return a=parseInt($(e.currentTarget).text()),t.paging(a)}}(this)),$("[data-role='page_prev']").on("click",function(t){return function(e){var a;return a=t.topic_page-1,t.paging(a)}}(this)),$("[data-role='page_next']").on("click",function(t){return function(e){var a;return a=t.topic_page+1,t.paging(a)}}(this))},a.prototype.importer_enable=function(){return $("[data-import]").on("click",function(t){return function(e){var a,n;return $("[data-import]").addClass("disabled"),a=$(e.currentTarget).data("import"),n={topics:[],news:[]},"news"===a?n.news=t.select_cells.filter(function(t){return"number"==typeof t}):(n.topics=t.select_cells.filter(function(t){return"string"==typeof t}),n.news=t.select_cells.filter(function(t){return"number"==typeof t})),console.log("\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4e2d..."),$.ajax({type:"GET",url:"import",data:{selected:n},success:function(t){return $("[data-import]").removeClass("disabled")},error:function(t){return $("[data-import]").removeClass("disabled")}})}}(this)),$("[data-combine]").on("click",function(t){return function(e){var a,n;return a=$("#profile_name").val(),$("#profile_name").parent().removeClass("has-error"),a?($("[data-combine]").addClass("disabled"),n=t.select_cells.filter(function(t){return"number"==typeof t}),$.ajax({type:"GET",url:"combine",data:{selected:n,name:a},success:function(t){return $("[data-combine]").removeClass("disabled")},error:function(t){return $("[data-combine]").removeClass("disabled")}})):$("#profile_name").parent().addClass("has-error")}}(this))},a.prototype.make_icon_check=function(){var t,e;return t=$("<i>"),$(t).attr("class","fa fa-check-circle"),$(t).css("opacity",0),e=$(t).get(0).outerHTML},a}(),this.Plotter=function(){function e(e,a,n){this.plot=t(this.plot,this),this.mount=t(this.mount,this),this.clear_axis=t(this.clear_axis,this);var i,r;this.width=e,this.height=a,this.picker=n,this.stage=d3.select(".stage").append("svg"),this.dataset=[],this.user_data=[],this.stage.attr("width",this.width).attr("height",this.height),this.padding=30,this.xScale=d3.scale.linear().domain([0,1]).range([this.padding,this.width-this.padding]),this.yScale=d3.scale.linear().domain([0,1]).range([this.height-this.padding,this.padding]),i=d3.svg.axis().scale(this.xScale).orient("bottom"),r=d3.svg.axis().scale(this.yScale).orient("left"),this.stage.append("g").attr("class","axis_x").attr("transform","translate(0, "+(this.height-this.padding)+")").call(i),this.stage.append("g").attr("class","axis_y").attr("transform","translate("+this.padding+", 0)").call(r)}return e.prototype.change_axis=function(t,e){return $("[data-title='"+t+"']").html(e).parent().removeClass("open"),$("[data-label='"+t+"']").html(e)},e.prototype.clear_axis=function(t){return this.dataset.forEach(function(e){return function(a,n){return"X"===t&&(e.dataset[n].x=.5,e.user_data.x=.5),"Y"===t&&(e.dataset[n].y=.5,e.user_data.y=.5),$("[data-title='"+t+"']").html(t+"\u8ef8\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0")}}(this)),this.plot()},e.prototype.mount=function(t,e,a){switch(t){case"x":if("user"!==e)return this.dataset[e]?this.dataset[e].x=a:this.dataset[e]={x:a,y:.5};if(this.user_data&&(this.user_data.x=a,!this.user_data.y))return this.user_data.y=.5;break;case"y":return"user"===e?this.user_data?(this.user_data.x||(this.user_data.x=.5),this.user_data.y=a):this.user_data={x:.5,y:a}:this.dataset[e]?this.dataset[e].y=a:this.dataset[e]={x:.5,y:a}}},e.prototype.plot=function(){var t,e,a,n;return a=this,e=.8,n=this.padding*e,t=this.padding*e,this.stage.selectAll("image").remove(),this.dataset.forEach(function(e){return function(i,r){return e.stage.append("image").attr("x",e.xScale(i.x)-.5*n).attr("y",e.yScale(i.y)-.5*t).attr("class","document").attr("width",n).attr("height",t).attr("xlink:href","/images/document_gray.svg").on("mouseover",function(){return a.picker.fetch({news_id:r},"details"),d3.select(this).attr("xlink:href","/assets/document_blue.svg")}).on("mouseout",function(){return d3.select(this).attr("xlink:href","/assets/document_gray.svg")}).on("click",function(){return console.log("open",r)})}}(this)),this.stage.append("image").attr("x",this.xScale(this.user_data.x)-.5*n).attr("y",this.yScale(this.user_data.y)-.5*t).attr("class","document").attr("width",n).attr("height",t).attr("xlink:href","/images/user.svg")},e}(),this.Rating=function(){function t(t){this.user_id=t}return t.prototype.rating_enable=function(){return $("[data-news]").draggable({axis:"x",revert:!0,revertDuration:100,opacity:.7,handle:".panel-heading",scroll:!1,drag:function(t,e){var a;return a=e.position.left,a>150&&$(e.helper).removeClass("panel-info").addClass("panel-success"),-150>a&&$(e.helper).removeClass("panel-info").addClass("panel-danger"),a>=-150&&150>=a?$(e.helper).removeClass("panel-info, panel-danger").addClass("panel-info"):void 0},stop:function(t){return function(e,a){var n,i,r;return r=a.position.left,n=$(a.helper).data("news"),r>150&&(i=1),-150>r&&(i=-1),r>=-150&&150>=r&&(i=0),t.push(n,i)}}(this)})},t.prototype.push=function(t,e){return $.ajax({url:"/articles/push_rate",type:"get",data:{news_id:t,sign:e},dataType:"json",success:function(e){var a,n;return n=$("[data-news='"+t+"']").find("h3"),a=new RegExp("glyphicon-ok","i"),n.html().match(a)||$(n).prepend('<span class="glyphicon glyphicon-ok" aria-hidden="true"></span> '),$(".progress-bar").animate({width:100*e.checked/50+"%"},{duration:300}),50<=e.checked?make_profile():void 0}})},t}()}.call(this),function(){}.call(this),function(){}.call(this);